<!-- This page now *extends* base.html -->
{% extends "base.html" %}

{% block title %}View Request: {{ req.title }}{% endblock %}

{% block content %}
<div class="container">
    <h2>ğŸ“„ Request: {{ req.title }}</h2>
    
    <div class="request-details">
        <p><b>Submitted By:</b> {{ req.creator.username }}</p>
        <p><b>Submitted On:</b> {{ req.created_at.strftime('%d-%m-%Y %I:%M %p') }}</p>
        <p><b>Overall Status:</b> <span class="status {{ req.status.split(' ')[0] }}">{{ req.status }}</span></p>
    </div>

    <h3>Letter Content:</h3>
    <div class="letter-box">{{ req.description }}</div>

    <div class="request-actions">
        <!-- Approve / Reject buttons based on role & status -->
        {% if current_user.role == "class_teacher" and req.class_teacher_status == "Pending" %}
            <form action="{{ url_for('approve_request', req_id=req.id) }}" method="post">
                <button type="submit" class="btn btn-success">âœ… Approve</button>
            </form>
            <form action="{{ url_for('reject_request', req_id=req.id, role='class_teacher') }}" method="post">
                <button type="submit" class="btn btn-danger">âŒ Reject</button>
            </form>
        {% elif current_user.role == "hod" and req.class_teacher_status == "Approved" and req.hod_status == "Pending" %}
            <form action="{{ url_for('approve_request', req_id=req.id) }}" method="post">
                <button type="submit" class="btn btn-success">âœ… Approve</button>
            </form>
            <form action="{{ url_for('reject_request', req_id=req.id, role='hod') }}" method="post">
                <button type="submit" class="btn btn-danger">âŒ Reject</button>
            </form>
        {% elif current_user.role == "principal" and req.hod_status == "Approved" and req.principal_status == "Pending" %}
            <form action="{{ url_for('approve_request', req_id=req.id) }}" method="post">
                <button type="submit" class="btn btn-success">âœ… Approve</button>
            </form>
            <form action="{{ url_for('reject_request', req_id=req.id, role='principal') }}" method="post">
                <button type="submit" class="btn btn-danger">âŒ Reject</button>
            </form>
        {% endif %}

        <!-- PDF download (only after Principal approves) -->
        {% if req.principal_status == "Approved" %}
            <a href="{{ url_for('generate_pdf', req_id=req.id) }}" class="btn btn-pdf">ğŸ“¥ Download PDF</a>
        {% endif %}

        <a href="{{ url_for('dashboard') }}" class="btn btn-secondary">â¬… Back to Dashboard</a>
    </div>
</div>
{% endblock %}
